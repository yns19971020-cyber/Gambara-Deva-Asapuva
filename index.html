<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∂ú‡∂∏‡∑ä‡∂∑‡∑è‡∂ª ‡∂Ø‡∑ö‡∑Ä ‡∂Ö‡∑É‡∂¥‡∑î‡∑Ä - ‡∂±‡∑í‡∂Ω ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∑è‡∑Ä</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vast-player@latest/dist/vast-player.min.js"></script>

    <style>
        :root { --gold: #FFD700; --dark: #000000; --card: #121212; --text: #ffffff; --accent: #1db954; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans Sinhala', sans-serif; background: var(--dark); color: var(--text); padding-bottom: 50px; }

        /* Admin UI */
        .admin-only { display: none; }
        .delete-btn { color: #ff4444 !important; cursor: pointer; font-size: 18px; }

        /* Notifications */
        #notificationContainer { position: fixed; top: 70px; right: 20px; z-index: 2000; width: 300px; }
        .toast { background: var(--gold); color: #000; padding: 12px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); font-weight: bold; border-left: 5px solid #000; animation: slideIn 0.5s; }

        /* Cover & Navbar */
        .cover-section { position: relative; width: 100%; height: 250px; background: #222; border-bottom: 2px solid var(--gold); }
        #coverImg { width: 100%; height: 100%; object-fit: cover; }
        .admin-btn { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8); color: var(--gold); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 5px; cursor: pointer; display: none; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: #000; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 1000; }
        .user-img { width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--gold); }
        .btn-gold { background: var(--gold); color: #000; border: none; padding: 6px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        /* Post Styles */
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }
        .post-card { background: var(--card); border-radius: 12px; margin-bottom: 20px; border: 1px solid #222; overflow: hidden; position: relative; }
        .post-header { padding: 12px; display: flex; align-items: center; justify-content: space-between; }
        .author-info { display: flex; align-items: center; gap: 10px; }
        .post-desc { color: #888; font-size: 13px; margin-bottom: 8px; font-style: italic; }
        .post-body { padding: 15px; line-height: 1.6; }
        .symbol { color: var(--gold); font-weight: bold; }
        .post-media video, .post-media img { width: 100%; display: block; }

        /* Alignment */
        .text-left { text-align: left; } .text-center { text-align: center; } .text-right { text-align: right; }

        /* Actions */
        .actions { display: flex; border-top: 1px solid #222; padding: 10px; justify-content: space-around; background: #0a0a0a; }
        .act-btn { background: none; border: none; color: #aaa; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .act-btn:hover { color: var(--gold); }

        /* Modal & Footer */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); width: 90%; max-width: 500px; padding: 20px; border-radius: 15px; border: 1px solid var(--gold); }
        .align-tools { display: flex; gap: 10px; margin-bottom: 10px; }
        .tool-btn { background: #222; color: #fff; border: 1px solid #444; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .tool-btn.active { color: var(--gold); border-color: var(--gold); }
        input, textarea { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        footer { background: #000; padding: 30px; text-align: center; border-top: 1px solid #222; margin-top: 20px; font-size: 12px; color: #666; }
        .fab { position: fixed; bottom: 25px; right: 25px; background: var(--gold); color: #000; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; z-index: 1500; }

        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

    <div id="notificationContainer"></div>

    <div class="cover-section">
        <img id="coverImg" src="https://via.placeholder.com/1200x400/000/ffd700?text=Gambara+Deva+Asapuwa">
        <button id="adminCoverBtn" class="admin-btn" onclick="document.getElementById('coverInp').click()">üì∏ Cover ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
        <input type="file" id="coverInp" hidden accept="image/*">
    </div>

    <div class="navbar">
        <div id="userInfo" style="display:flex; align-items:center; gap:10px;">‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä!</div>
        <button class="btn-gold" id="loginBtn" onclick="login()">Login</button>
        <button class="btn-gold" id="logoutBtn" style="display:none; background:#ff4444;" onclick="logout()">Logout</button>
    </div>

    <div class="container" id="feed"></div>

    <div class="fab" onclick="document.getElementById('uploadModal').style.display='flex'">+</div>

    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <h3 style="color:var(--gold); margin-bottom:15px;">‡∂±‡∑Ä ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫‡∂ö‡∑ä ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h3>
            <input type="text" id="postTitle" placeholder="‡∂∏‡∑è‡∂≠‡∑ò‡∂ö‡∑è‡∑Ä (Title)">
            <input type="text" id="postDesc" placeholder="‡∂ö‡∑ô‡∂ß‡∑í ‡∑Ñ‡∑ê‡∂≥‡∑í‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏ (AdSense Description)">
            <div class="align-tools">
                <button class="tool-btn active" onclick="setAlign('left', this)">Left</button>
                <button class="tool-btn" onclick="setAlign('center', this)">Center</button>
                <button class="tool-btn" onclick="setAlign('right', this)">Right</button>
            </div>
            <textarea id="postText" rows="5" placeholder="‡∂Ö‡∂Ø‡∑Ñ‡∑É ‡∂∏‡∑ô‡∂≠‡∂± ‡∂Ω‡∑í‡∂∫‡∂±‡∑ä‡∂±..."></textarea>
            <input type="file" id="fileInp" accept="image/*,video/*,audio/*">
            <button class="btn-gold" style="width:100%; padding:12px;" id="uploadBtn" onclick="uploadPost()">PUBLISH</button>
            <button onclick="document.getElementById('uploadModal').style.display='none'" style="width:100%; background:none; border:none; color:#888; margin-top:10px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <footer>
        <a href="#" style="color:#666; text-decoration:none;">Privacy Policy</a> | 
        <a href="#" style="color:#666; text-decoration:none;">Terms & Conditions</a> | 
        <a href="#" style="color:#666; text-decoration:none;">About Us</a>
        <p style="margin-top:10px;">&copy; 2026 ‡∂ú‡∂∏‡∑ä‡∂∑‡∑è‡∂ª ‡∂Ø‡∑ö‡∑Ä ‡∂Ö‡∑É‡∂¥‡∑î‡∑Ä.</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAanlxAHMadJGae_22SjmavNI6SBZ8kTdk",
            authDomain: "gambara-deva.firebaseapp.com",
            projectId: "gambara-deva",
            storageBucket: "gambara-deva.firebasestorage.app",
            messagingSenderId: "1020790060573",
            appId: "1:1020790060573:web:70671a642389ceb33df8f4"
        };
        
        const VAST_TAG_URL = "YOUR_VAST_TAG_HERE"; 
        const ADMIN_EMAIL = "yns19971020@gmail.com";
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dodxrer08/upload";
        const UPLOAD_PRESET = "ml_default";

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let user = null;
        let selectedAlign = 'left';

        auth.onAuthStateChanged(u => {
            user = u;
            if(u) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'block';
                document.getElementById('userInfo').innerHTML = `<img src="${u.photoURL}" class="user-img"> <span>${u.displayName}</span>`;
                if(u.email === ADMIN_EMAIL) document.getElementById('adminCoverBtn').style.display = 'block';
            }
        });

        function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function logout() { auth.signOut(); location.reload(); }
        function setAlign(a, b) { selectedAlign = a; document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active')); b.classList.add('active'); }

        function highlight(t) { return t.replace(/([\*\!\?\"\'\:\-])/g, '<span class="symbol">$1</span>'); }

        async function uploadPost() {
            const title = document.getElementById('postTitle').value;
            const desc = document.getElementById('postDesc').value;
            const text = document.getElementById('postText').value;
            const file = document.getElementById('fileInp').files[0];
            if(!title || !text) return alert("‡∂∏‡∑è‡∂≠‡∑ò‡∂ö‡∑è‡∑Ä ‡∑É‡∑Ñ ‡∂Ω‡∑í‡∂¥‡∑í‡∂∫ ‡∂¥‡∑î‡∂ª‡∑Ä‡∂±‡∑ä‡∂±!");

            const btn = document.getElementById('uploadBtn');
            btn.disabled = true; btn.innerText = "Processing...";

            let mediaUrl = ""; let mediaType = "";
            if(file) {
                const fd = new FormData(); fd.append('file', file); fd.append('upload_preset', UPLOAD_PRESET);
                const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: fd });
                const d = await res.json();
                mediaUrl = d.secure_url; mediaType = d.resource_type;
            }

            await db.collection('posts').add({
                title, desc, content: text, align: selectedAlign, mediaUrl, mediaType,
                author: user ? user.displayName : "Anonymous",
                authorImg: user ? user.photoURL : "https://via.placeholder.com/40",
                likes: 0, timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await db.collection('notifications').add({ text: `‡∂±‡∑Ä ‡∂¥‡∑ù‡∑É‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö‡∂ö‡∑ä: ${title}`, time: firebase.firestore.FieldValue.serverTimestamp() });
            location.reload();
        }

        db.collection('posts').orderBy('timestamp', 'desc').onSnapshot(snap => {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            snap.forEach(doc => {
                const p = doc.data(); const id = doc.id;
                let media = '';
                if(p.mediaUrl) {
                    if(p.mediaType === 'video') media = `<div class="post-media"><video controls src="${p.mediaUrl}"></video></div>`;
                    else if(p.mediaType === 'image') media = `<div class="post-media"><img src="${p.mediaUrl}"></div>`;
                    else media = `<audio controls style="width:100%;" src="${p.mediaUrl}"></audio>`;
                }

                feed.innerHTML += `
                    <div class="post-card">
                        <div class="post-header">
                            <div class="author-info">
                                <img src="${p.authorImg}" class="user-img">
                                <div><b>${p.title}</b><br><small>${p.author}</small></div>
                            </div>
                            ${user && user.email === ADMIN_EMAIL ? `<span class="material-icons delete-btn" onclick="deletePost('${id}')">delete</span>` : ''}
                        </div>
                        <div class="post-body text-${p.align}">
                            ${p.desc ? `<div class="post-desc">${p.desc}</div>` : ''}
                            <p>${highlight(p.content)}</p>
                        </div>
                        ${media}
                        <div class="actions">
                            <button class="act-btn" onclick="likePost('${id}')"><span class="material-icons">thumb_up</span> ${p.likes || 0}</button>
                            <button class="act-btn" onclick="sharePost('${p.title}')"><span class="material-icons">share</span></button>
                        </div>
                    </div>`;
            });
        });

        async function deletePost(id) {
            if(confirm("‡∂∏‡∑ô‡∂∏ ‡∂¥‡∑ù‡∑É‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑ì‡∂∏‡∂ß ‡∂î‡∂∂‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?")) {
                await db.collection('posts').doc(id).delete();
                alert("Post Deleted Successfully");
            }
        }

        function likePost(id) { db.collection('posts').doc(id).update({ likes: firebase.firestore.FieldValue.increment(1) }); }
        
        function sharePost(title) {
            if(navigator.share) navigator.share({ title: title, url: window.location.href });
            else window.open(`https://api.whatsapp.com/send?text=${title} - ${window.location.href}`);
        }

        db.collection('notifications').orderBy('time', 'desc').limit(1).onSnapshot(snap => {
            snap.docChanges().forEach(change => {
                if(change.type === "added") {
                    const t = document.createElement('div'); t.className = 'toast'; t.innerText = "üîî " + change.doc.data().text;
                    document.getElementById('notificationContainer').appendChild(t);
                    setTimeout(() => t.remove(), 5000);
                }
            });
        });

        document.getElementById('coverInp').addEventListener('change', async e => {
            const file = e.target.files[0];
            if(file && user.email === ADMIN_EMAIL) {
                const fd = new FormData(); fd.append('file', file); fd.append('upload_preset', UPLOAD_PRESET);
                const res = await fetch(CLOUDINARY_URL, { method: 'POST', body: fd });
                const d = await res.json();
                db.collection('settings').doc('site').set({ cover: d.secure_url });
            }
        });
        db.collection('settings').doc('site').onSnapshot(doc => { if(doc.exists) document.getElementById('coverImg').src = doc.data().cover; });

    </script>
</body>
</html>
